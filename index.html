<!-- é«˜ä¸­è·å°è«–æ–‡æ ¼å¼è‡ªæª¢ç³»çµ±ï¼ˆç°¡åŒ–ç‰ˆï¼‰ -->
<!-- Version: v=2025-10-30a -->
<!-- Build date: 2025-10-30 -->
<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>é«˜ä¸­è·å°è«–æ–‡æ ¼å¼è‡ªæª¢ï¼ˆç°¡åŒ–ç‰ˆ v=2025-10-30bï¼‰</title>

<style>
:root{--bg:#f7f7fb;--card:#fff;--ink:#111827;--muted:#6b7280;--accent:#2563eb;--border:#e5e7eb}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans TC","PingFang TC",sans-serif}
.wrap{max-width:960px;margin:auto;padding:24px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-top:14px}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.hint{color:var(--muted);font-size:13px}
.drop{border:2px dashed #cbd5e1;border-radius:12px;padding:24px;text-align:center;background:#fafafa;margin-top:8px}
input[type=file]{display:none}
label.file{display:inline-flex;gap:.6rem;padding:.7rem 1rem;border:1.5px dashed #cbd5e1;border-radius:10px;background:#fff;cursor:pointer}
button{padding:.7rem 1.1rem;border-radius:10px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
button.primary{background:var(--accent);color:#fff;border-color:transparent}
.ok{color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;padding:.1rem .5rem;border-radius:999px;font-size:12px}
.bad{color:#991b1b;background:#fef2f2;border:1px solid #fecaca;padding:.1rem .5rem;border-radius:999px;font-size:12px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #e5e7eb;padding:8px 10px;text-align:left;vertical-align:top}
th{background:#f9fafb}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
.btn-gpt{background:#f8c8dc;color:#333;border:1px solid #f5a6c4;border-radius:10px;padding:.7rem 1.1rem;font-weight:600;cursor:pointer;text-decoration:none}
.margin-preview .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:#374151;margin:6px 0}
.margin-preview .dot{display:inline-block;width:10px;height:10px;border-radius:2px;border:2px solid #111}
.margin-preview .dot.red{border-color:#be123c;border-style:dashed}
.margin-preview .dot.blue{border-color:#1d4ed8;border-style:dashed}
.num{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;margin-right:6px;border-radius:999px;background:#eef2ff;border:1px solid #e5e7eb;font-size:12px;color:#374151;font-weight:600}
footer{margin-top:24px;text-align:center;color:#6b7280;font-size:13px}
</style>

<!-- pdf.js loader -->
<script type="module">
  window.loadPdfjs = async () => {
    const base = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/";
    const { GlobalWorkerOptions, getDocument } = await import(base + "pdf.min.mjs");
    GlobalWorkerOptions.workerSrc = base + "pdf.worker.min.mjs";
    return { getDocument };
  };
</script>
</head>
<body>
<div class="wrap">
  <h1 style="margin:0 0 6px">é«˜ä¸­è·å°è«–æ–‡æ ¼å¼è‡ªæª¢ï¼ˆç°¡åŒ–ç‰ˆï¼‰</h1>
  <!-- æ”¾åœ¨ <h1>...</h1> ä¹‹å¾Œ -->
  <p class="hint" id="counterBox">
  ç›®å‰ç´¯ç©å°è«–æ–‡æ ¼å¼è‡ªæª¢äººæ¬¡ï¼š<b id="counter">è¼‰å…¥ä¸­â€¦</b>
  <span class="mono">ï½œv=2025-10-30a</span>
  </p>
  <p class="hint" style="margin-top:8px">Â© 2025 CTVS å‡¡äº‹çš†æ­£é¢ Â· r91628120@ctvs.ptc.edu.tw</p>
  
  <p class="hint">
    æœ¬é åƒ…ä¿ç•™ï¼š#15 å››å‘¨é‚Šç•Œã€#10 æ ¡å¤–ç™¼è¡¨æª¢ç´¢ï¼ˆäº¤ GPTï¼‰ã€Cloud Run å­—é«”å­—å‹é€²éšæª¢æŸ¥ã€‚
    <strong>ç‰ˆæœ¬ï¼šv=2025-10-30a</strong>
  </p>

  <section class="card">
    <div class="row">
      <div class="hint">PDFï¼ˆâ‰¤ 5 MBï¼‰</div>
    </div>
    <div style="margin-top:8px">
      <input id="consent" type="checkbox"/>
      <label for="consent">æˆ‘å·²é–±è®€ä¸¦åŒæ„ï¼Œä¸”ç¢ºèªæª”æ¡ˆä¸å« <span class="mono">æ ¡å/å§“å</span>ã€‚</label>
    </div>

    <div id="drop" class="drop" aria-disabled="true">
      <p><strong>æ‹–æ‹‰ PDF åˆ°é€™è£¡</strong></p>
      <label for="file" class="file">é¸æ“‡æª”æ¡ˆ</label>
      <input id="file" type="file" accept=".pdf" disabled/>
      <p class="hint" id="status">è«‹å…ˆå‹¾é¸åŒæ„ã€‚</p>
    </div>

<!-- å‹¾é¸åŒæ„å€å¾Œé¢ç·Šæ¥è‘—åŠ ä¸Š -->
<details style="margin-top:8px">
  <summary><strong>ä¸Šå‚³èˆ‡è³‡æ–™ä¿å­˜æ”¿ç­–ï¼ˆå¿…è®€ï¼‰</strong></summary>
  <ul>
    <li>åƒ…åšæ ¼å¼æª¢æŸ¥ï¼Œä¸åšå­˜è­‰æˆ–æŠ•ç¨¿ã€‚</li>
    <li>è§£ææ–¼ç€è¦½å™¨è¨˜æ†¶é«”ï¼Œå®Œæˆå¾Œå³é‡‹æ”¾ï¼›æœ¬ç«™ä¸ä¿å­˜ã€‚</li>
    <li>è«‹å‹¿å«å€‹è³‡ï¼ˆæ ¡åã€å§“åã€ç­ç´šï¼‰ã€‚</li>
  </ul>
</details>

<p style="color:#444; font-size:14px; margin-top:6px; line-height:1.6;">
  ğŸ’¡ <b>ä½¿ç”¨å»ºè­°ï¼š</b>å…ˆç”¨æœ¬é é€²è¡Œ #15 é‚Šç•Œå¿«é€Ÿæª¢æŸ¥ï¼Œå†æŒ‰ä¸‹æ–¹
  <b>ã€Œå–®ç¨ GPT æª¢æŸ¥ PDFï¼ˆGPT Bï¼‰ã€</b> åšæ›´å®Œæ•´åˆ†æï¼ˆå«é ç¢¼æ¨™è¨»ã€åœ–è¡¨/æ–‡ç»ä¸€è‡´æ€§ç­‰ï¼‰ã€‚
  <br>ğŸ§© å…©è€…æ­é…ä½¿ç”¨ï¼Œèƒ½ç²å¾—æœ€æº–ç¢ºçš„è‡ªæª¢çµæœã€‚
</p>


    <div class="row" style="margin-top:8px">
      <button id="start" class="primary" disabled>é–‹å§‹æª¢æŸ¥ï¼ˆ#15 é‚Šç•Œï¼‰</button>
      <button id="fontCheckBtn" disabled>å­—é«”å­—å‹é€²éšæª¢æŸ¥ï¼ˆCloud Runï¼‰</button>
      <a class="btn-gpt" id="gptB" target="_blank" rel="noopener"
         href="https://chatgpt.com/g/g-68f77bc5d4008191802b3e5984de6f72-gao-zhong-zhi-xiao-lun-wen-ge-shi-ji-he-yuan-copy">å–®ç¨ GPT æª¢æŸ¥ PDFï¼ˆGPT Bï¼‰</a>
      <a class="primary" id="gptA" style="text-decoration:none" target="_blank" rel="noopener"
         href="https://chatgpt.com/g/g-68c6d9e700c88191872154808e0e0e7b-gao-zhong-zhi-xiao-lun-wen-ge-shi-zi-jian-xi-tong"><button id="gptAButton" class="primary" type="button">AI å°åŠ©æ‰‹ï¼ˆGPT Aï¼‰</button>
      </a>
    </div>
  </section>

  <section class="card" id="resultCard" style="display:none">
    <h3>æª¢æŸ¥çµæœ</h3>
    <div id="fileTag" class="hint" style="margin:6px 0 12px"></div>
    <table>
      <thead><tr><th>è¦å‰‡</th><th>çµæœ</th><th>è­‰æ“š / èªªæ˜</th><th>å»ºè­°</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
    <div class="row" style="margin-top:10px">
      <button id="downloadHtml">ä¸‹è¼‰æª¢æŸ¥çµæœï¼ˆç¶²é ï¼‰</button>
    </div>
  </section>

  <footer>Â© 2025 CTVS å‡¡äº‹çš†æ­£é¢ ï½œ v=2025-10-30a</footer>
</div>

<button id="gptAButton" class="primary" type="button">AI å°åŠ©æ‰‹ï¼ˆGPT Aï¼‰</button>



<script>
/* ========= å¸¸æ•¸èˆ‡ç‹€æ…‹ ========= */
const CLOUD_RUN_BASE = "https://font-check-api-1009467346209.asia-east1.run.app";
const CLOUD_RUN_ENDPOINT = CLOUD_RUN_BASE + "/check";

const consent  = document.getElementById('consent');
const fileInput= document.getElementById('file');
const drop     = document.getElementById('drop');
const statusEl = document.getElementById('status');
const startBtn = document.getElementById('start');
const fontBtn  = document.getElementById('fontCheckBtn');
const resultCard = document.getElementById('resultCard');
const tbody    = document.getElementById('tbody');
const fileTag  = document.getElementById('fileTag');
const downloadHtmlBtn = document.getElementById('downloadHtml');

let arrayBuffer=null, fileName='', fileExt='pdf';

/* ========= åŒæ„ â†’ å•Ÿç”¨ ========= */
function setEnabled(ok){
  fileInput.disabled = !ok;
  startBtn.disabled  = !ok || !arrayBuffer;
  fontBtn.disabled   = !ok || !arrayBuffer;
  statusEl.textContent = ok ? (arrayBuffer ? 'å·²é¸æ“‡æª”æ¡ˆï¼Œæº–å‚™é–‹å§‹ã€‚' : 'å·²åŒæ„ï¼Œå¯é¸æª”ã€‚') : 'è«‹å…ˆå‹¾é¸åŒæ„ã€‚';
}
setEnabled(false);
consent.addEventListener('change', ()=>setEnabled(consent.checked));

/* ========= é¸æª”/æ‹–æ‹‰ ========= */
['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();if(!fileInput.disabled)drop.classList.add('drag');}));
['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();drop.classList.remove('drag');}));
drop.addEventListener('drop',e=>{if(fileInput.disabled)return;const f=e.dataTransfer.files?.[0];if(f)handleFile(f);});
fileInput.addEventListener('change',e=>{const f=e.target.files?.[0];if(f)handleFile(f);});

async function handleFile(f){
  if((f.name.split('.').pop()||'').toLowerCase()!=='pdf'){statusEl.textContent='åƒ…æ”¯æ´ PDF';return;}
  if(f.size>5*1024*1024){statusEl.textContent='è¶…é 5MB ä¸Šé™';return;}
  arrayBuffer = await f.arrayBuffer();
  fileName = f.name;
  setEnabled(consent.checked);
}

/* ========= å·¥å…·èˆ‡é‡æ¸¬å¸¸æ•¸ ========= */
const SKIP_PAGE_TOKEN = /å°è«–æ–‡è©•åˆ†è¡¨/;   // å«æ­¤å­—æ¨£ä¹‹é ï¼Œä¸€å¾‹è·³éæ‰€æœ‰æª¢æŸ¥
const CM_TO_PT = cm => cm * 72 / 2.54;

const BASE_CM = 2.0;
const TOL_CM  = 0.2;
const MARGIN_PT    = CM_TO_PT(BASE_CM);         // 2.0 cm
const RANGE_MIN_PT = CM_TO_PT(BASE_CM - TOL_CM);// 1.8 cmï¼ˆè—ï¼‰
const RANGE_MAX_PT = CM_TO_PT(BASE_CM + TOL_CM);// 2.2 cmï¼ˆç´…ï¼‰
const MICRO_TOL_PT = 0.8;                       // é‡æ¸¬å¾®èª¤å·®

function within(v){ return isFinite(v) && v >= (RANGE_MIN_PT - MICRO_TOL_PT) && v <= (RANGE_MAX_PT + MICRO_TOL_PT); }
function esc(s){return String(s??'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]);}

/* ========= è¦–è¦ºå°ºè¦ï¼ˆSVGï¼‰ ========= */
function buildMarginPreviewSVG({W,H,measLeft,measRight,measTop,measBottom}){
  const thumbW=240, scale=thumbW/W, th=Math.round(H*scale);
  const insetBlack=MARGIN_PT*scale, insetRed=RANGE_MAX_PT*scale, insetBlue=RANGE_MIN_PT*scale;
  const mL=Math.max(0,(measLeft??0)*scale), mR=Math.max(0,(measRight??0)*scale), mT=Math.max(0,(measTop??0)*scale), mB=Math.max(0,(measBottom??0)*scale);
  return `
<div class="margin-preview">
<svg width="${thumbW}" height="${th}" viewBox="0 0 ${thumbW} ${th}" xmlns="http://www.w3.org/2000/svg" style="background:#fff;border:1px solid #e5e7eb;border-radius:8px">
  <rect x="0.5" y="0.5" width="${thumbW-1}" height="${th-1}" fill="white" stroke="#9ca3af"/>
  <rect x="${insetBlack}" y="${insetBlack}" width="${thumbW-2*insetBlack}" height="${th-2*insetBlack}" fill="none" stroke="#111" stroke-width="2"/>
  <rect x="${insetRed}" y="${insetRed}" width="${thumbW-2*insetRed}" height="${th-2*insetRed}" fill="none" stroke="#be123c" stroke-width="2" stroke-dasharray="6 4"/>
  <rect x="${insetBlue}" y="${insetBlue}" width="${thumbW-2*insetBlue}" height="${th-2*insetBlue}" fill="none" stroke="#1d4ed8" stroke-width="2" stroke-dasharray="6 4"/>
  ${Number.isFinite(mL)?`<line x1="${mL}" y1="0" x2="${mL}" y2="${th}" stroke="#16a34a" stroke-width="2"/>`:''}
  ${Number.isFinite(mR)?`<line x1="${thumbW-mR}" y1="0" x2="${thumbW-mR}" y2="${th}" stroke="#16a34a" stroke-width="2"/>`:''}
  ${Number.isFinite(mT)?`<line x1="0" y1="${mT}" x2="${thumbW}" y2="${mT}" stroke="#16a34a" stroke-width="2"/>`:''}
  ${Number.isFinite(mB)?`<line x1="0" y1="${th-mB}" x2="${thumbW}" y2="${th-mB}" stroke="#16a34a" stroke-width="2"/>`:''}
</svg>
<div class="legend">
  <span class="dot"></span><span>é»‘ï¼š2.0 cm</span>
  <span class="dot red"></span><span>ç´…ï¼š2.2 cmï¼ˆä¸Šé™ï¼‰</span>
  <span class="dot blue"></span><span>è—ï¼š1.8 cmï¼ˆä¸‹é™ï¼‰</span>
</div>
</div>`;
}

/* ========= è¡¨æ ¼è¼¸å‡º ========= */
let _ruleCounter=0;
function addRow(rule, pass, evidenceHtml, suggestionHtml){
  const tr=document.createElement('tr');
  const badge = pass ? '<span class="ok">é€šé</span>' : '<span class="bad">æœªé€šé</span>';
  tr.innerHTML = `<td><span class="num">${++_ruleCounter}</span>${rule}</td>
                  <td>${badge}</td>
                  <td>${evidenceHtml||''}</td>
                  <td>${suggestionHtml||''}</td>`;
  tbody.appendChild(tr);
}

/* ========= Cloud Run å­—é«”å­—å‹é€²éšæª¢æŸ¥ ========= */
fontBtn.addEventListener('click', async ()=>{
  const picked = document.querySelector('#file')?.files?.[0];
  const blob = picked || (arrayBuffer ? new Blob([arrayBuffer], {type:"application/pdf"}) : null);
  if(!blob){ alert('è«‹å…ˆé¸æ“‡ PDF æª”'); return; }

  statusEl.textContent = 'ä¸Šå‚³è‡³ Cloud Run æª¢æŸ¥ä¸­â€¦';
  try{
    const fd = new FormData();
    fd.append('file', blob, fileName||'upload.pdf'); // å¸¸è¦‹å¾Œç«¯æ¬„ä½å
    const res = await fetch(CLOUD_RUN_ENDPOINT + '?v=' + Date.now(), {
      method:'POST', mode:'cors', cache:'no-store', body:fd
    });
    const text = await res.text();
    if(!res.ok) throw new Error(`API ${res.status} ${res.statusText} ${text}`);
    const data = (()=>{ try{return JSON.parse(text);}catch{return { ok:true, raw:text }; } })();

    const pass = (typeof data.pass==='boolean')?data.pass:(data.summary?.pass ?? data.ok ?? false);
    const parts = [];
    if(data.summary?.pages) parts.push(`é æ•¸ï¼š${data.summary.pages}`);
    if(data.summary?.dominant_fonts) parts.push(`ä¸»è¦å­—é«”ï¼š${data.summary.dominant_fonts.join('ã€')}`);
    if(Array.isArray(data.top_fonts)) parts.push('å¸¸è¦‹å­—é«”ï¼š'+data.top_fonts.slice(0,6).join('ã€'));
    if(data.layout?.per_page_margins?.length){
      const f = data.layout.per_page_margins[0];
      parts.push(`ç¬¬1é é‚Šç•Œé‡æ¸¬ï¼šå·¦${f.left} / å³${f.right} / ä¸Š${f.top} / ä¸‹${f.bottom} pt`);
    }
    addRow('Cloud Run å­—é«”å­—å‹æª¢æŸ¥', !!pass, esc(parts.join('ï½œ')), pass?'OKï¼ˆé€šéï¼‰':'è«‹ä¾è¦ç¯„ä¿®æ­£å­—é«”ã€‚');
    resultCard.style.display='block';
    fileTag.textContent = `æ­¤æ¬¡æª¢æŸ¥æª”æ¡ˆï¼š${fileName||'(æœªå‘½å)'}`;
    statusEl.textContent = 'Cloud Run æª¢æŸ¥å®Œæˆã€‚';
  }catch(err){
    addRow('Cloud Run å­—é«”å­—å‹æª¢æŸ¥', false, esc(String(err.message||err)), 'è«‹ç¢ºèªå¾Œç«¯å…è¨±åŒ¿åã€å·²é–‹ CORSï¼Œä¸”å‰ç«¯ç¢ºå¯¦é€å‡ºæª”æ¡ˆã€‚');
    resultCard.style.display='block';
    statusEl.textContent = 'Cloud Run æª¢æŸ¥å¤±æ•—ã€‚';
  }
});

/* ========= #15 é‚Šç•Œä¸»æµç¨‹ ========= */
startBtn.addEventListener('click', async ()=>{
  if(!arrayBuffer) return;
  tbody.innerHTML=''; _ruleCounter=0;
  statusEl.textContent = 'è§£æ PDF ä¸­â€¦';
  try{
    const {getDocument}=await window.loadPdfjs();
    const pdf = await getDocument({data:arrayBuffer}).promise;
    const numPages = pdf.numPages;

    // è®€å–æ¯é æ–‡å­—
    const pageTexts = [];
    for(let p=1;p<=numPages;p++){
      const page = await pdf.getPage(p);
      const tc = await page.getTextContent();
      pageTexts[p] = tc.items.map(it=>it.str||'').join(' ');
    }

    // æ‰¾åˆ°è¦ç•¥éçš„é ï¼ˆå«ã€Œå°è«–æ–‡è©•åˆ†è¡¨ã€ï¼‰
    const skipPages=new Set();
    for(let i=1;i<=numPages;i++){
      if(SKIP_PAGE_TOKEN.test(pageTexts[i]||'')) skipPages.add(i);
    }
    if(skipPages.size>0){
      addRow('ç•¥éç‰¹å®šé é¢', true,
        `åµæ¸¬åˆ°å«ã€Œå°è«–æ–‡è©•åˆ†è¡¨ã€é æ¬¡ï¼š${[...skipPages].join(', ')}`,
        'æ­¤é ä¸ç´å…¥å…§æ–‡ã€åœ–è¡¨ã€å¼•è¨»ã€åƒè€ƒæ–‡ç»ã€é æ•¸ã€é ç¢¼ã€é‚Šç•Œç­‰æª¢æŸ¥ã€‚');
    }

    // é‡æ¸¬ï¼ˆä»¥é¦–é ã€ˆå£¹ã€å‰è¨€ã€‰è¡Œç‚ºæ­£æ–‡ä¸Šç·£åŸºæº–ï¼›è·³éè©•åˆ†è¡¨é ï¼‰
    let minLeft=Infinity,minRight=Infinity,minTop=Infinity,minBottom=Infinity;
    let firstSectionY=null, firstSectionLeftX=Infinity, page1H=null, page1W=null;

    for(let p=1;p<=numPages;p++){
      if(skipPages.has(p)) continue;
      const page = await pdf.getPage(p);
      const viewport = page.getViewport({scale:1});
      const W=viewport.width, H=viewport.height;
      if(p===1){ page1H=H; page1W=W; }
      const tc = await page.getTextContent();

      for(const it of tc.items){
        const tr=it.transform, x=tr[4], y=tr[5], w=(typeof it.width==='number')?it.width:0;
        const txt=(it.str||'').trim();

        if(p===1 && txt && /^\s*(å£¹|ä¸€|1)\s*[ã€ï¼\.]\s*å‰è¨€\s*$/.test(txt)){
          firstSectionY = y;
          if (x < firstSectionLeftX) firstSectionLeftX = x;
        }

        // æ­£æ–‡å€ï¼ˆæ’é™¤ä¸Šä¸‹ 2cmï¼‰
        const inBody = (y > MARGIN_PT) && (y < (H - MARGIN_PT));
        if(p===1 && inBody){
          // æ­£æ–‡éœ€ä½æ–¼ã€ˆå£¹ã€å‰è¨€ã€‰ä¹‹ä¸‹ï¼ˆæŠ“ä¸åˆ°å‰‡ä¿å®ˆä¼°ï¼‰
          const ok = firstSectionY ? (y < firstSectionY - 2) : (y < (H - MARGIN_PT - 40));
          if(ok){
            const distLeft=x, distRight=W-(x+w), distBottom=y, distTop=H-y;
            if(distLeft   < minLeft)   minLeft   = distLeft;
            if(distRight  < minRight)  minRight  = distRight;
            if(distBottom < minBottom) minBottom = distBottom;
            if(distTop    < minTop)    minTop    = distTop;
          }
        }
      }
    }

    const leftForCheck = isFinite(firstSectionLeftX) ? firstSectionLeftX : minLeft;
    const topForCheck  = isFinite(page1H) && isFinite(firstSectionY) ? (page1H - firstSectionY) : minTop;
    const pass = within(leftForCheck) && within(topForCheck);

    const evText =
      `ï¼ˆåƒ…ç¬¬1é ã€ä»¥ã€Œå£¹ã€å‰è¨€ã€ç‚ºåŸºæº–ï¼›ç•¥éé ï¼š${skipPages.size}ï¼‰ä¸»è¦é‡æ¸¬ï¼ˆptï¼‰ï¼š` +
      `å·¦ ${isFinite(leftForCheck)?leftForCheck.toFixed(1):'â€”'}ã€` +
      `ä¸Š ${isFinite(topForCheck)?topForCheck.toFixed(1):'â€”'}ï¼ˆå…è¨±èª¤å·®Â±${MICRO_TOL_PT}ptï¼‰ï½œ` +
      `åƒè€ƒå€¼ï¼ˆç•¥æª¢ï¼‰ï¼šå³ ${isFinite(minRight)?minRight.toFixed(1):'â€”'}ã€ä¸‹ ${isFinite(minBottom)?minBottom.toFixed(1):'â€”'}`;

    let svgHtml = '';
    if (isFinite(page1W) && isFinite(page1H)) {
      svgHtml = buildMarginPreviewSVG({
        W: page1W, H: page1H,
        measLeft: leftForCheck, measRight:minRight, measTop: topForCheck, measBottom:minBottom
      });
    }

    addRow(
      'å››å‘¨é‚Šç•Œ 2 å…¬åˆ†ï¼ˆæ­£æ–‡å€æ¨ä¼°ï¼‰',
      pass,
      `<div>${esc(evText)}</div>${svgHtml}`,
      `ä¾è€å¸«åˆ¤æº–ï¼šä»¥é¦–é ã€ˆå£¹ã€å‰è¨€ã€‰è¡Œä½œç‚ºæ­£æ–‡ä¸Šç·£åŸºæº–ï¼Œæª¢ã€Œå·¦/ä¸Šã€ç‚ºä¸»ï¼›å³/ä¸‹åƒ…ç•¥æª¢ã€‚
       è¦ç¯„ 2.0cmï¼Œè½‰æª”èª¤å·® Â±0.2cmï¼ˆ1.8â€“2.2cmï¼‰è¦–ç‚ºåˆæ ¼ï¼›è¶…å‡ºç´…æ¡†ç‚ºä¸åˆæ ¼ï¼Œå®Œå…¨è½å…¥è—æ¡†ç‚ºéå¯¬ã€‚`
    );

    // #10ï¼šå¤–éƒ¨æª¢ç´¢æç¤ºï¼ˆäº¤ GPT Aï¼‰
    const qTitle = encodeURIComponent((fileName||'å°è«–æ–‡é¡Œå').replace(/\.[^.]+$/,''));
    const searchList = `
      <div class="hint" style="margin-top:6px">
        å»ºè­°ç”¨ä¸‹åˆ—æŸ¥è©¢äº¤çµ¦ <b>AI å°åŠ©æ‰‹ï¼ˆGPT Aï¼‰</b> é€²è¡Œå½™æ•´æ¯”å°ï¼š
        <ul style="margin:6px 0 0 18px">
          <li class="mono"><a target="_blank" rel="noopener" href="https://scholar.google.com/scholar?hl=zh-TW&q=${qTitle}">Google Scholarï¼š${esc(fileName)}</a></li>
          <li class="mono"><a target="_blank" rel="noopener" href="https://www.google.com/search?q=${qTitle}+%E5%B0%8F%E8%AB%96%E6%96%87+%E5%BE%97%E7%8D%8E">Googleï¼šé¡Œå + å°è«–æ–‡ å¾—ç</a></li>
          <li class="mono"><a target="_blank" rel="noopener" href="https://www.google.com/search?q=${qTitle}+site%3Ashs.edu.tw">Google é™ç«™ï¼šsite:shs.edu.tw</a></li>
          <li class="mono"><a target="_blank" rel="noopener" href="https://www.google.com/search?q=${qTitle}+site%3Aedu.tw+%E5%B0%8F%E8%AB%96%E6%96%87">Google é™ç«™ï¼šsite:edu.tw å°è«–æ–‡</a></li>
        </ul>
        ç”± GPT çµ±æ•´å‰ 10 ç­†ï¼ˆæ¨™é¡Œã€ä¾†æºã€å¹´ä»½ã€é€£çµï¼‰ï¼Œä¸¦åˆ¤æ–·æ˜¯å¦ç–‘ä¼¼ç›¸åŒé¡Œåä¹‹å…¬é–‹ç™¼è¡¨æˆ–å¾—çç´€éŒ„ã€‚
      </div>`;
    addRow(
      'ä½œå“æ˜¯å¦å·²æ–¼æ ¡å¤–ç™¼è¡¨/å¾—çï¼ˆäº¤ GPT æŸ¥è­‰ï¼‰',
      true,
      searchList,
      'é»ä¸Šæ–¹ã€ŒAI å°åŠ©æ‰‹ï¼ˆGPT Aï¼‰ã€æŒ‰éˆ•ï¼ŒæŠŠæŸ¥è©¢éœ€æ±‚è²¼çµ¦ GPTï¼Œè«‹å…¶å½™æ•´ä¸¦çµ¦çµè«–ã€‚'
    );

    resultCard.style.display='block';
    fileTag.textContent = `æ­¤æ¬¡æª¢æŸ¥æª”æ¡ˆï¼š${fileName||'(æœªå‘½å)'}ï¼›é æ•¸ï¼š${numPages}ï¼ˆç•¥éå«ã€Œå°è«–æ–‡è©•åˆ†è¡¨ã€ä¹‹é ï¼š${Array.from(skipPages).join(', ')||'ç„¡'}ï¼‰`;
    statusEl.textContent = 'å®Œæˆæª¢æŸ¥ã€‚';

  }catch(err){
    statusEl.textContent = 'è§£æå¤±æ•—ï¼šè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦æœ‰æ•ˆã€‚';
    console.error(err);
  }
});

/* ========= ä¸‹è¼‰çµæœï¼ˆHTMLï¼‰ ========= */
downloadHtmlBtn.addEventListener('click', ()=>{
  const html='<!doctype html><meta charset="utf-8"><title>å°è«–æ–‡æª¢æŸ¥å ±å‘Šï¼ˆç°¡åŒ–ç‰ˆ v=2025-10-30aï¼‰</title>'
    + '<style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans TC","PingFang TC",sans-serif;margin:24px;}'
    + 'table{border-collapse:collapse;width:100%}th,td{border:1px solid #e5e7eb;padding:8px 10px;text-align:left;vertical-align:top}'
    + 'th{background:#f9fafb}.ok{color:#065f46}.bad{color:#991b1b}.hint{color:#6b7280;font-size:13px}</style>'
    + document.querySelector('#resultCard').outerHTML;
  const blob=new Blob([html],{type:'text/html;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='paper-check-report-simple.html';
  a.click();
  URL.revokeObjectURL(a.href);
});
</script>
</body>
</html>
