<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>高中職小論文格式自檢系統</title>

  <!-- 預先載入規則 JSON，提升首次速度 -->
  <link rel="preload" href="rules.json" as="fetch" crossorigin>

  <!-- 禁快取（避免舊版殘留） -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <style>
    :root{--bg:#f7f7fb;--card:#fff;--ink:#111827;--muted:#6b7280;--accent:#2563eb;--border:#e5e7eb}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans TC","PingFang TC",sans-serif}
    .wrap{max-width:960px;margin:auto;padding:24px}
    header h1{margin:0 0 4px;font-size:clamp(22px,4vw,28px)}header p{margin:0;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-top:14px}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}.pill{background:#eef2ff;border:1px solid #e5e7eb;border-radius:999px;padding:.3rem .6rem;font-size:12px}
    .hint{color:var(--muted);font-size:13px}.drop{border:2px dashed #cbd5e1;border-radius:12px;padding:24px;text-align:center;background:#fafafa;margin-top:8px}
    input[type=file]{display:none}label.file{display:inline-flex;gap:.6rem;padding:.7rem 1rem;border:1.5px dashed #cbd5e1;border-radius:10px;background:#fff;cursor:pointer}
    button{padding:.7rem 1.1rem;border-radius:10px;border:1px solid #d1d5db;background:#fff;cursor:pointer}button.primary{background:var(--accent);color:#fff;border-color:transparent}button:disabled{opacity:.5;cursor:not-allowed}
    .ok{color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;padding:.1rem .5rem;border-radius:999px;font-size:12px}
    .bad{color:#991b1b;background:#fef2f2;border:1px solid #fecaca;padding:.1rem .5rem;border-radius:999px;font-size:12px}
    table{border-collapse:collapse;width:100%}th,td{border:1px solid #e5e7eb;padding:8px 10px;text-align:left;vertical-align:top}th{background:#f9fafb}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}pre{white-space:pre-wrap;max-height:260px;overflow:auto;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:8px}
    .filetag{font-size:13px;color:#374151;margin:6px 0 0}.num{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;margin-right:6px;border-radius:999px;background:#eef2ff;border:1px solid #e5e7eb;font-size:12px;color:#374151;font-weight:600}
    .extsearch{background:#f9fafb;border:1px dashed #e5e7eb;border-radius:10px;padding:10px;margin-top:6px}.extsearch ul{margin:6px 0 0 18px;padding:0}.extsearch li{margin:4px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>高中職小論文格式自檢系統（v1.4 / 2025-10-17）</h1>
      <p>支援 PDF / DOCX；解析僅在瀏覽器記憶體中，完成即釋放，不留存。</p>
      <div class="hint" id="counterBox">
        目前累積小論文格式自檢人次：<b id="counter">載入中…</b>
      </div>
      <div class="hint" style="margin-top:8px">© 2025 CTVS Library · r91628120@ctvs.ptc.edu.tw</div>
    </header>

    <section class="card">
      <div class="row"><div class="pill">PDF / DOCX</div><div class="pill">頁數 4–10</div><div class="pill">≤ 5MB</div><div class="pill">不得含校名／姓名</div></div>
      <details style="margin-top:8px">
        <summary><strong>上傳與資料保存政策（必讀）</strong></summary>
        <ul>
          <li>僅做格式檢查，不做存證或投稿。</li>
          <li>解析於瀏覽器記憶體，完成後即釋放；本站不保存。</li>
          <li>請勿含個資（校名、姓名、班級）。</li>
        </ul>
      </details>

      <div class="row" style="margin-top:8px">
        <input id="consent" type="checkbox"/>
        <label for="consent">我已閱讀並同意，且確認檔案不含 <span class="mono">校名/姓名</span>。</label>
      </div>

      <div id="drop" class="drop" aria-disabled="true">
        <p><strong>拖拉 PDF 或 DOCX 到這裡</strong></p>
        <label for="file" class="file">選擇檔案</label>
        <input id="file" type="file" accept=".pdf,.docx" disabled/>
        <p class="hint">完成檢查即釋放／不保存。</p>
      </div>

      <div class="row" style="margin-top:8px">
        <button id="start" class="primary" disabled>開始檢查</button>
        <button id="clear" disabled>清除</button>
        <button id="fontCheckBtn" disabled>字體字型進階檢查</button>
        <span id="status" class="hint" role="status" aria-live="polite"></span>
      </div>
    </section>

    <section class="card" id="spec">
      <h2>系統檢查規則（合格標準）</h2>
      <ol>
        <li>頁數：4–10 頁。</li>
        <li>首頁篇名需置中且落在距上緣 2 公分內。</li>
        <li>首頁頁碼需置中且落在距下緣 2 公分內。</li>
        <li>檔案名稱與頁首篇名一致（不符判定淘汰）。</li>
        <li>每頁需有置中頁碼（底端帶）。</li>
        <li>四周邊界 ≥ 2 公分（正文區推估）。</li>
        <li>不得有封面頁（4–10頁）。</li>
        <li>不得含校名/姓名（參考文獻之後的區段自動略過）。</li>
        <li>六大段落依序：前言 → 文獻探討 → 研究方法 → 研究分析與結果 → 研究結論與建議 → 參考文獻。</li>
        <li>內文引註採 作者-年份；直接引文 ≤ 50 字（不含標點）。</li>
        <li>參考文獻 ≥ 3；同時顯示四層統計（總數/合格/不合格/網路來源）。</li>
        <li>圖表需有標號/標題與來源（表內已引注可不於表下再標）。</li>
        <li>參考文獻與內文引註一致；來源不可全為網路。</li>
        <li>字體/字型規範（可用進階檢查）。</li>
        <li>校外發表/得獎：外部檢索助手 + GPT 提示。</li>
      </ol>
      <p class="hint">※ 本系統為輔助工具，仍需老師覆核。</p>
    </section>

    <section class="card" id="resultCard" style="display:none">
      <h3>檢查結果</h3>
      <div id="fileTag" class="filetag"></div>
      <table>
        <thead><tr><th>規則</th><th>結果</th><th>證據 / 說明</th><th>建議</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="row" style="margin-top:8px">
        <button id="downloadHtml">下載檢查結果（網頁）</button>
        <button id="copyJson">複製檢查結果 (給AI助手)</button>
        <button id="downloadJson">儲存檢查結果檔案</button>
        <a id="openGpts" class="primary" href="https://chatgpt.com/g/g-68c6d9e700c88191872154808e0e0e7b-gao-zhong-zhi-xiao-lun-wen-ge-shi-zi-jian-xi-tong" target="_blank" rel="noopener">打開AI助手（貼上檢查結果）</a>
      </div>
      <pre id="jsonPreview" class="mono" style="margin-top:8px"></pre>
    </section>
  </div>

  <!-- 全部邏輯集中到 main.js -->
  <script src="main.js"></script>
</body>
</html>